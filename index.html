<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>K-Comp Pro â€“ Professional Image Compressor</title>
  <meta name="description" content="A high-performance, offline-capable image compressor inspired by Caesium.">
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/1829/1829586.png">
  <style>
    :root {
      --bg-color: #121212;
      --card-bg: #1e1e1e;
      --accent: #4caf50;
      --text-color: #ffffff;
      --subtle: #aaaaaa;
      --radius: 8px;
    }

    body {
      margin: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: start;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      background: var(--card-bg);
      padding: 30px;
      border-radius: var(--radius);
      max-width: 720px;
      width: 100%;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    }

    h1 {
      margin-top: 0;
      font-size: 1.8rem;
    }

    .controls label {
      display: block;
      margin: 10px 0 4px;
      color: var(--subtle);
    }

    input[type="number"], select, input[type="range"] {
      width: 100%;
      padding: 8px;
      border-radius: var(--radius);
      border: none;
      margin-bottom: 10px;
    }

    .drop-zone {
      border: 2px dashed #555;
      border-radius: var(--radius);
      padding: 30px;
      text-align: center;
      color: var(--subtle);
      margin-bottom: 20px;
      cursor: pointer;
    }

    .drop-zone.dragover {
      background-color: #222;
    }

    .preview {
      margin-top: 20px;
      max-width: 100%;
      display: none;
    }

    .info {
      font-size: 0.9em;
      color: var(--subtle);
      margin-top: 10px;
    }

    .btn {
      background-color: var(--accent);
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: var(--radius);
      font-size: 1rem;
      cursor: pointer;
      width: 100%;
    }

    .btn:hover {
      background-color: #66bb6a;
    }
  </style>
</head>
<body>
  <main class="container" role="main">
    <h1>K-Comp Pro</h1>
    <p>Paste (Ctrl+V), drop, or upload images to compress locally. No upload, no tracking.</p>
    <div class="drop-zone" id="dropZone">Click or drop image here</div>
    <input type="file" id="fileInput" accept="image/*" style="display:none;">
    <div class="controls">
      <label for="resizeWidth">Resize Width (px):</label>
      <input type="number" id="resizeWidth" min="50" max="8000" value="1000">

      <label for="format">Output Format:</label>
      <select id="format">
        <option value="image/jpeg">JPEG</option>
        <option value="image/png">PNG</option>
        <option value="image/webp">WebP</option>
      </select>

      <label for="quality">Compression Quality:</label>
      <input type="range" id="quality" min="0.1" max="1" step="0.05" value="0.7">
      <span id="qLabel">70%</span>
    </div>
    <button class="btn" id="compressBtn">Compress & Download</button>
    <div class="info" id="info"></div>
    <img class="preview" id="preview" alt="Compressed Preview">
  </main>

  <script>
    const fileInput = document.getElementById('fileInput');
    const dropZone = document.getElementById('dropZone');
    const compressBtn = document.getElementById('compressBtn');
    const resizeWidth = document.getElementById('resizeWidth');
    const format = document.getElementById('format');
    const quality = document.getElementById('quality');
    const qLabel = document.getElementById('qLabel');
    const preview = document.getElementById('preview');
    const info = document.getElementById('info');

    let imgDataUrl = null;
    let imgName = 'image';

    quality.addEventListener('input', () => {
      qLabel.textContent = `${Math.round(quality.value * 100)}%`;
    });

    dropZone.addEventListener('click', () => fileInput.click());

    dropZone.addEventListener('dragover', e => {
      e.preventDefault();
      dropZone.classList.add('dragover');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('dragover');
    });

    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.classList.remove('dragover');
      if (e.dataTransfer.files[0]) {
        handleFile(e.dataTransfer.files[0]);
      }
    });

    fileInput.addEventListener('change', e => {
      if (e.target.files[0]) {
        handleFile(e.target.files[0]);
      }
    });

    document.addEventListener('paste', e => {
      const items = e.clipboardData.items;
      for (const item of items) {
        if (item.type.startsWith('image/')) {
          const file = item.getAsFile();
          if (file) handleFile(file);
        }
      }
    });

    function handleFile(file) {
      if (!file.type.startsWith('image/')) return alert('Please select a valid image.');
      const reader = new FileReader();
      reader.onload = e => {
        imgDataUrl = e.target.result;
        imgName = file.name.replace(/\.[^/.]+$/, '');
        preview.src = imgDataUrl;
        preview.style.display = 'block';
        info.textContent = '';
      };
      reader.readAsDataURL(file);
    }

    compressBtn.addEventListener('click', () => {
      if (!imgDataUrl) return alert('No image loaded.');

      const image = new Image();
      image.onload = () => {
        const canvas = document.createElement('canvas');
        const scale = parseInt(resizeWidth.value) / image.naturalWidth;
        const width = parseInt(resizeWidth.value);
        const height = image.naturalHeight * scale;

        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(image, 0, 0, width, height);

        canvas.toBlob(blob => {
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `${imgName}-Comp.${format.value.split('/')[1]}`;
          link.click();

          blob.arrayBuffer().then(buf => {
            const originalSize = atob(imgDataUrl.split(',')[1] || '').length;
            const compressedSize = buf.byteLength;
            const saved = ((originalSize - compressedSize) / originalSize * 100).toFixed(1);
            info.textContent = `Saved ${(originalSize - compressedSize) / 1024 | 0} KB (${saved}%)`;
          });
        }, format.value, parseFloat(quality.value));
      };
      image.src = imgDataUrl;
    });
  </script>
</body>
</html>
